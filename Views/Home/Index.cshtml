@model BookDisplayModel


@{

}
<div class="my-2">
    <form method="get" asp-controller="Home" asp-action="Index" class="d-flex align-items-center gap-3">

        <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                Select
            </button>

            <ul class="dropdown-menu p-3" data-bs-auto-close="outside" style="min-width: 220px;">

                @foreach (var genre in Model.Genres)
                {
                    <li class="form-check">
                        <input class="form-check-input" type="radio" name="genreId" value="@genre.Id" @(Model.GenreId ==
                                                                                                                              genre.Id ? "checked" : "") id="genre_@genre.Id" onchange="this.form.submit()" />

                        <label class="form-check-label" for="genre_@genre.Id">
                            @genre.GenreName
                        </label>
                    </li>

                }

            </ul>
        </div>


        <!-- SEARCH (SUBMIT YOK, ENTER İLE) -->
        <input type="text" name="sterm" value="@Model.Sterm" class="form-control" placeholder="Search by Title"
            style="max-width: 250px;" />

    </form>


</div>

<div class="w-100 d-flex mt-4 flex-wrap">

    @foreach (var book in Model.Books)
    {
        <div class="card mx-2 mb-4" style="width: 16rem;">
            @if (string.IsNullOrEmpty(book.Image))
            {
                <img src="/images/NoImage.png" class="card-img-top" alt="...">
            }
            else
            {
                <img src="/images/@book.Image" class="card-img-top" alt="...">

            }

            <div class="card-body">
                <h5 class="card-title">@book.BookName</h5>
                <p class="card-text">
                    Genre:@book.GenreName
                    Author:@book.AuthorName
                    Price:@book.Price
                </p>
                <button type="buton" onclick="add(@book.Id)" class="btn btn-primary">Add to cart</button>
            </div>
        </div>

    }


</div>


@section Scripts {
    <script>
        async function add(bookId) {
            try {
                const response = await fetch(`/Cart/AddItem?bookId=${bookId}`);

                if (response.redirected) {
                    window.location.href = response.url;
                    return;
                }

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById("cartCount").innerHTML = result;
                }
            } catch (err) {
                console.log(err);
            }
        }
    </script>
}